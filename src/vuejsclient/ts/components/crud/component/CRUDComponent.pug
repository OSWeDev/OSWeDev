include ../../../../views/mixins/loading.pug

.crud-wrapper
    +loading()
        .crud-table-wrapper
            .table-title
                h5 {{ CRUDTitle }}
                .btn-group.d-print-none
                    button.btn.btn-sm.btn-secondary.m-1(@click='reload_datas()')
                        i.fa.fa-refresh.fa-lg.btn_icon(aria-hidden="true")
                        | {{ label('crud.actions.refresh') }}
                    button.btn.btn-sm.btn-outline-dark.m-1(v-if="isExportableToXLSX", href="#", @click="export_to_xlsx()")
                        i.fa.fa-download.fa-lg.btn_icon
                        | {{ label('crud.actions.export') }}
                    router-link.btn.btn-sm.btn-success.m-1(:to="getCRUDCreateLink(api_type_id)", v-if='(!crud.forced_readonly) && (!isModuleParamTable)')
                        i.fa.fa-plus-circle.fa-lg.btn_icon
                        | {{ label('crud.actions.create') }}
                    //- a.btn.btn-danger(role="button" href="#deleteData" data-toggle="modal" v-if="select_options && (select_options.length > 1)")
                    //-     i.fa.fa-trash
                    //-     span {{ label('crud.actions.delete') }}
            datatable.crud_datatable(
                :key="'datatable_' + crud.readDatatable.API_TYPE_ID"
                :datatable="crud.readDatatable",
                :update_button="!crud.forced_readonly",
                :delete_button="!crud.forced_readonly",
                :multiselectable="false",
                :api_types_involved="api_types_involved",
                :load_datas="false")

        <!-- Create Modal HTML -->
        #createData.modal.fade.in(v-if='!isModuleParamTable', tabindex='-1', role='dialog')
            .modal-dialog.modal-lg(role='document')
                .modal-content
                    form(v-on:submit.prevent="createVO")
                        .modal-header
                            h4.modal-title {{ label('crud.create.modal.title') }}
                            router-link.btn.close(:to="callback_route") &times;
                        .modal-body
                            .alert.alert-warning(v-if="is_only_readable") {{ label('crud.create.modal.readonly') }}
                            template(v-if="newVO")
                                template(v-if="createDatatableFields", v-for="field in createDatatableFields")
                                    crud_field(
                                        :field="field",
                                        :vo="newVO",
                                        :default_field_data="newVO[field.datatable_field_uid]",
                                        :field_select_options_enabled="field.select_options_enabled",
                                        @inputValue="inputValue",
                                        @uploadedFile="uploadedFile",
                                        @onChangeVO="onChangeVO",
                                        @validateMultiInput="validateMultiInput",
                                    )

                            template(v-else)
                                p {{ label('crud.create.modal.content.newvo_failure') }}
                        .modal-footer
                            router-link.btn.btn-default(:to="callback_route" v-if="!creating_vo") {{ label('crud.create.modal.cancel') }}
                            template(v-if="newVO && !creating_vo && !is_only_readable")
                                input.btn.btn-primary(type="submit" :value="label('crud.create.modal.add')")
        <!-- Edit Modal HTML -->
        #updateData.modal.fade.in(tabindex='-1', role='dialog')
            .modal-dialog.modal-lg(role='document')
                .modal-content
                    form(v-on:submit.prevent="updateVO")
                        .modal-header
                            h4.modal-title {{ label('crud.update.modal.title') }}
                            router-link.btn.close(:to="callback_route") &times;
                        .modal-body
                            .alert.alert-danger(v-if="is_only_readable") {{ label('crud.update.modal.readonly') }}
                            template(v-if="selectedVO && editableVO")
                                template(v-for="field in crud.updateDatatable.fields")
                                    crud_field(
                                        :field="field",
                                        :vo="editableVO",
                                        :default_field_data="editableVO[field.datatable_field_uid]",
                                        :field_select_options_enabled="field.select_options_enabled",
                                        @changeValue="changeValue",
                                        @uploadedFile="uploadedFile",
                                        @onChangeVO="onChangeVO",
                                        @validateMultiInput="validateMultiInput",
                                    )
                                            
                            template(v-else)
                                p {{ label('crud.update.modal.content.selection_failure') }}
                        .modal-footer
                            router-link.btn.btn-default(:to="callback_route" v-if="!updating_vo") {{ label('crud.update.modal.cancel') }}
                            template(v-if="selectedVO && editableVO && !updating_vo && !is_only_readable")
                                input.btn.btn-primary(type="submit" :value="label('crud.update.modal.save')")

        #deleteData.modal.fade.in(v-if='!isModuleParamTable', tabindex='-1', role='dialog')
            .modal-dialog.modal-lg(role='document')
                .modal-content
                    form(v-on:submit.prevent="deleteVO")
                        .modal-header
                            h4.modal-title {{ label('crud.delete.modal.title') }}
                            router-link.btn.close(:to="callback_route") &times;
                        .modal-body
                            .alert.alert-danger(v-if="is_only_readable") {{ label('crud.delete.modal.readonly') }}
                            template(v-if="selectedVO")
                                p {{ label('crud.delete.modal.content') }}
                                    .text-warning
                                        small {{ label('crud.delete.modal.content.warning') }}
                            template(v-else)
                                p {{ label('crud.delete.modal.content.selection_failure') }}
                        .modal-footer
                            router-link.btn.btn-default(:to="callback_route" v-if="!deleting_vo") {{ label('crud.delete.modal.cancel') }}
                            template(v-if="selectedVO && !deleting_vo && !is_only_readable")
                                input.btn.btn-danger(type="submit" :value="label('crud.delete.modal.delete')")