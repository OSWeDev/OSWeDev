.oselia_thread_widget_component_wrapper(@dragover.prevent='handle_drag_over' @drop.prevent='handle_drop' @dragleave.prevent='handle_drag_leave')
    //- template(v-if='too_many_threads')
    //-     .too_many_threads.bg-primary
    //-         i.fa-duotone.fa-filters
    //-         | {{ label('oselia_thread_widget_component.too_many_threads') }}

    Oselialeftpanelcomponent(
        :class="{'opened': get_left_panel_open}"
        :current_thread_id='current_thread_id'
    )
    
    .oselia_thread_widget_header 
        template(v-if='!get_left_panel_open')
            .oselia_thread_widget_header_icon_open
                i.fa.fa-chevron-right(@click="openLeftPanel")

    .oselia_thread_widget_component

        template(v-if='is_dragging')
            .dragging_overlay
                .dragging_overlay_text
                    i.fa-duotone.fa-upload
                    | {{ label('oselia_thread_widget_component.dragging_overlay_text') }}

        template(v-if="enable_link_image_menu")
            .link_image_menu
                .label_link_menu {{ label('oselia_thread_widget_component.link_image_menu.title') }}
                    input(v-model='link_image_url' :placeholder="label('oselia_thread_widget_component.link_image_menu.url_placeholder')")
                .buttons
                    button(v-on:click='upload_link_image') {{ label('oselia_thread_widget_component.image_upload_menu_item.upload') }}
                    button(v-on:click='cancel_link_image') {{ label('oselia_thread_widget_component.image_upload_menu_item.cancel') }}

        template(v-if='has_access_to_thread')
            template(v-if='is_loading_thread')
                .is_loading_thread
                    i.fa-duotone.fa-spinner-third.fa-spin

            template(v-else)
                .thread_container(ref='thread_container' :class="is_dragging ? 'blur' : '' ")  
                    //- .update_button 
                    //-     button.btn.btn-sm.btn-primary(v-on:click='force_reload')
                    //-         i.fa-duotone.fa-sync
                    
                    template(v-if='(!thread_messages) || (!thread_messages.length)')
                        .no_messages
                            i.fa-duotone.fa-comments
                            | {{ label('oselia_thread_widget_component.no_messages') }}
                    .thread_messages
                        template(v-for='thread_message in thread_messages')
                            Oseliathreadmessagecomponent(
                                :thread='thread'
                                :thread_message='thread_message'
                                @thread_message_updated='thread_message_updated'
                            )
                        template(v-if='thread.oselia_is_running')
                            .thread_message.thread_message_assistant
                                .thread_message_header
                                    .thread_message_header_left
                                        .thread_message_header_left_avatar
                                            img(:src='role_assistant_avatar_url')
                                        .thread_message_header_left_username
                                            | {{ label('oselia_thread_widget_component.thread_message_header_left_username.oselia') }}

                                    .thread_message_body
                                        .thread_message_body_content
                                            .thread_message_body_text
                                                i.fa-duotone.fa-spinner-third.fa-spin

                    .oselia_runs(v-if='get_show_hidden_messages && oselia_runs && oselia_runs.length')
                        .oselia_runs_wrapper(:class="{'expand':expand_oselia_runs}")
                            .oselia_runs_header(@click='expand_oselia_runs = !expand_oselia_runs') {{ label('oselia_thread_widget_component.oselia_runs_header') }}
                                i.fa-duotone.fa-chevron-down(v-if='!expand_oselia_runs')
                                i.fa-duotone.fa-chevron-up(v-else)
                            .oselia_runs_content(v-if='expand_oselia_runs')
                                Oseliarunarbocomponent(
                                    :thread_id='thread.id'
                                    :parent_run_id='null'
                                )

                    .function_calls(v-if='get_show_hidden_messages && function_calls && function_calls.length')
                        .function_calls_wrapper(:class="{'expand':expand_function_calls}")
                            .function_calls_header(@click='expand_function_calls = !expand_function_calls') {{ label('oselia_thread_widget_component.function_calls_header') }}
                                i.fa-duotone.fa-chevron-down(v-if='!expand_function_calls')
                                i.fa-duotone.fa-chevron-up(v-else)
                            .function_calls_content(v-if='expand_function_calls')
                                template(v-for='function_call in function_calls')
                                    .function_call
                                        .function_call_name {{ functions_by_id[function_call.gpt_function_id].gpt_function_name }}
                                        vue-json-pretty.function_call_function_call_parameters_initial(:data='try_parse_json(function_call.function_call_parameters_initial)' :deep='1')
                                        vue-json-pretty.function_call_result(:data='try_parse_json(function_call.result)' :deep='1')

                    .thread_cached_datas(v-if='get_show_hidden_messages && thread_cached_datas && thread_cached_datas.length')
                        .thread_cached_datas_wrapper(:class="{'expand':expand_thread_cached_datas}")
                            .thread_cached_datas_header(@click='expand_thread_cached_datas = !expand_thread_cached_datas') {{ label('oselia_thread_widget_component.thread_cached_datas_header') }}
                                i.fa-duotone.fa-chevron-down(v-if='!expand_thread_cached_datas')
                                i.fa-duotone.fa-chevron-up(v-else)
                            .thread_cached_datas_content(v-if='expand_thread_cached_datas')
                                template(v-for='cached_data in thread_cached_datas')
                                    .thread_cached_data
                                        .thread_cached_data_key {{ cached_data.key }}
                                        vue-json-pretty.thread_cached_data_value(:data='try_parse_json(cached_data.value)' :deep='1')

                    .parent_thread(v-if='get_show_hidden_messages && thread.parent_thread_id' @click='select_thread_id(thread.parent_thread_id)') {{ label('oselia_thread_widget_component.parent_thread') }}

                    .sub_threads(v-if='get_show_hidden_messages && sub_threads && sub_threads.length')
                        .sub_threads_wrapper(:class="{'expand':expand_sub_threads}")
                            .sub_threads_header(@click='expand_sub_threads = !expand_sub_threads') {{ label('oselia_thread_widget_component.sub_threads_header') }}
                                i.fa-duotone.fa-chevron-down(v-if='!expand_sub_threads')
                                i.fa-duotone.fa-chevron-up(v-else)
                            .sub_threads_content(v-if='expand_sub_threads')
                                template(v-for='sub_thread in sub_threads')
                                    .sub_thread(@click='select_thread_id(sub_thread.id)') {{ sub_thread.thread_title }}

        
                    .thread_message_input
                        template(v-if="thread_files.length > 0")
                            .thread_files
                                template(v-for="(item, index) in thread_files")
                                    template(v-for="(value, key) in item")
                                        template(v-if="value.path")
                                            .thread_file
                                                button.fa-solid.fa-xmark(v-on:click='remove_file(index)')
                                                template(v-if="key == '.png' || key == '.jpg' || key == '.jpeg' || key == '.gif' || key == '.webp'")
                                                    img(:src="'/' + value.path")
                                                template(v-else-if="key == '.pdf'")
                                                    img(:src="'/vuejsclient/public/img/pdf.png'")
                                                template(v-else-if="key == '.csv'")
                                                    img(:src="'/vuejsclient/public/img/csv.png'")
                                                template(v-else-if="key == '.xlsx'")
                                                    img(:src="'/vuejsclient/public/img/xlsx.png'")
                                                template(v-else-if="key == '.txt'")
                                                    img(:src="'/vuejsclient/public/img/txt.png'")
                        .thread_message_input_textarea
                            textarea(v-model='new_message_text' rows="1" @keydown="handle_new_message_text_keydown" ref='new_message_textarea_ref')
                        .thread_message_input_buttons
                            .thread_message_input_button.thread_message_input_file_system
                                button.fa-solid.fa-files(v-on:click='open_file_system_upload')
                            .thread_message_input_button.thread_message_input_file
                                button.fa-solid.fa-paperclip(v-on:click='open_file_upload')
                            .thread_message_input_button.thread_message_input_image
                                button.fa-solid.fa-images(v-on:click='open_image_upload')
                                template(v-if="enable_image_upload_menu")
                                    .image_upload_menu
                                        .image_upload_menu_item(v-on:click='upload_image')
                                            i.fa-duotone.fa-upload
                                            | {{ label('oselia_thread_widget_component.image_upload_menu_item.upload') }}
                                        .image_upload_menu_item(v-on:click='open_link_image')
                                            i.fa-duotone.fa-images
                                            | {{ label('oselia_thread_widget_component.image_upload_menu_item.link') }}
                            .thread_message_input_button.thread_message_expand
                                button.fa-solid.fa-up-right-and-down-left-from-center(v-on:click='expand_window')
                            .thread_message_input_button.thread_message_debug(v-if="has_access_to_debug")
                                template(v-if="!get_show_hidden_messages")
                                    button.fa-solid.fa-bug(v-on:click='switch_show_hidden_messages')
                                template(v-else)
                                    button.fa-solid.fa-bug-slash(v-on:click='switch_show_hidden_messages')
                                
                        .thread_message_input_send
                            template(v-if='get_too_many_assistants')
                                .too_many_assistants.bg-warning
                                    i.fa-duotone.fa-comments-question
                                    | {{ label('oselia_thread_widget_component.too_many_assistants') }}
                            template(v-else-if='!get_can_run_assistant')
                                .no_assistant.bg-danger
                                    i.fa-duotone.fa-comments-question
                                    | {{ label('oselia_thread_widget_component.no_assistant') }}
                            template(v-else)
                                button.btn.btn-primary(v-on:click='send_message()' :disabled='assistant_is_busy || !new_message_text')
                                    i.fa-duotone.fa-paper-plane
                                    | {{ label('oselia_thread_widget_component.send_message') }}

        template(v-else)
            .no_access.bg-warning
                i.fa-duotone.fa-user-lock.fa-beat-fade(style='--fa-animation-iteration-count: 3')
                | {{ label('oselia_thread_widget_component.no_access') }}