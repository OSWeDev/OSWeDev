include ../../../../../views/mixins/loading.pug

.string_searchbar_widget_component
    template(v-if='vo_field_ref')
        .vo_field_ref_label {{ vo_field_ref_label }}
        .vo_field_advanced_string_filters(v-tooltip="tooltip")
            template(v-if='advanced_string_filter')
                .vo_field_advanced_string_filter
                    form(v-on:submit.prevent="validate_advanced_string_filter")
                        template(v-if="!hide_advanced_string_filter_type")
                            .advanced_string_filter_type
                                multiselect(
                                    :preselect-first="true"
                                    :multiple="false"
                                    :close-on-select="true"
                                    v-model="advanced_string_filter.filter_type"
                                    :options="filter_type_options"
                                    :custom-label="filter_type_label"
                                    autocomplete="off"
                                    :show-labels="false"
                                    :searchable="false"
                                    :internal-search="false"
                                    :hide-selected="false"

                                    :key="'advanced_string_filter_type' + vo_field_ref.api_type_id + '__' + vo_field_ref.field_id"

                                    :select-label='label("multiselect.selectLabel")'
                                    :select-group-label='label("multiselect.selectGroupLabel")'
                                    :selected-label='label("multiselect.selectedLabel")'
                                    :deselect-label='label("multiselect.deselectLabel")'
                                    :deselect-group-label='label("multiselect.deselectGroupLabel")'
                                    @input="onchange_advanced_string_filter_content"
                                )

                        .advanced_string_filter_content(v-if='has_content_filter_type[advanced_string_filter.filter_type]', :class="{hide_advanced_string_filter_type: hide_advanced_string_filter_type}")
                            input(
                                v-model='advanced_string_filter.filter_content'
                                :placeholder='advanced_mode_placeholder'
                                @change="onchange_advanced_string_filter_content"
                            )

                        template(v-if="!autovalidate_advanced_filter || active_field_on_autovalidate_advanced_filter")
                            .advanced_string_filter_validate_filter(v-tooltip.top='label("advanced_filters.validate")' @click='validate_advanced_string_filter')
                                i.fa-duotone.fa-check-circle.fa-lg.btn_icon

                template(v-if='is_loading_options')
                    i.loadingspinner.fa.fa-spinner.fa-spin(aria-hidden="true")
                template(v-else)
                    template(v-if='is_res_mode_list')
                        .context_active_string_filter_options
                            multiselect(
                                :preselect-first="false"
                                :multiple="false"
                                :close-on-select="true"
                                v-model="tmp_context_active_string_filter"
                                :options="context_active_string_filter_options"
                                :custom-label="context_active_string_filter_label"
                                autocomplete="off"
                                :show-labels="false"
                                :searchable="false"
                                :internal-search="false"
                                :hide-selected="false"

                                :key="'context_active_string_filter_options' + vo_field_ref.api_type_id + '__' + vo_field_ref.field_id"

                                :select-label='label("multiselect.selectLabel")'
                                :select-group-label='label("multiselect.selectGroupLabel")'
                                :selected-label='label("multiselect.selectedLabel")'
                                :deselect-label='label("multiselect.deselectLabel")'
                                :deselect-group-label='label("multiselect.deselectGroupLabel")'
                                @input="onchange_context_active_string_filter"
                            )

                    template(v-else)
                        .scrollable-table-container
                            table.table
                                thead
                                    tr
                                        th(v-for="(header, i) in Object.keys(context_active_string_filter_table_rows[0] || {})" :key="i") {{ header }}
                                tbody
                                    tr(
                                        v-for="(row, rowIndex) in context_active_string_filter_table_rows" 
                                        @click.prevent="onClickContextTableRow(row, rowIndex)" 
                                        :class="{ 'selected-row': rowIndex === selectedTableRowIndex }" 
                                        :key="rowIndex"
                                        style="cursor:pointer;"
                                    )
                                        td(v-for="(value, key, colIndex) in row" :key="key")
                                            template(v-if="colIndex === 0")
                                                a(href="#") {{ value }}
                                            template(v-else)
                                                | {{ value }}